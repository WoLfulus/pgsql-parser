#!/usr/bin/env node

const parser = require('pg-plpgsql-query-native').parseQuerySync;

function runQuery(query) {
  const result = parser.parseQuerySync(query);
  console.log(JSON.stringify(result, null, '  '));
}

if (process.argv[2]) {
  runQuery(process.argv[2]);
} else {
  var content = '';

  process.stdin.resume();

  process.stdin.on('data', (buf) => {
    content += buf.toString();
  });

  process.stdin.on('end', () => {
    runQuery(content);
  });
}
